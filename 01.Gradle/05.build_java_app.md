# Gradle을 이용해서 Java Application 구성하기
- [여기](https://guides.gradle.org/building-java-applications/)를 참고했으니 자세한 사항을 알고 싶으면 클릭
- 튜토리얼로 작성한 [java-app](../00.playground/01.Gradle/java-app/) 소스코드도 시간되면 구경
- 여기에서 할 일
  1. Gradle을 통해서 Java Application 템플릿 생성
  1. 생성된 템플릿의 구조 확인
  1. `classes`, `jar`, `build`, `run` 태스크 수행 및 확인
  1. 테스트 레포트 확인
  1. 끗

## 튜토리얼 수행 절차
1. `java-app` 디렉토리 생성
1. `java-app` 디렉토리 내부에서 `gradle init` 수행
   ```
   $ gradle init
   Starting a Gradle Daemon (subsequent builds will be faster)

   Select type of project to generate:
     1: basic
     2: application
     3: library
     4: Gradle plugin
   Enter selection (default: basic) [1..4] 2

   Select implementation language:
     1: C++
     2: Groovy
     3: Java
     4: Kotlin
     5: Swift
   Enter selection (default: Java) [1..5] 3

   Select build script DSL:
     1: Groovy
     2: Kotlin
   Enter selection (default: Groovy) [1..2] 1

   Select test framework:
     1: JUnit 4
     2: TestNG
     3: Spock
     4: JUnit Jupiter
   Enter selection (default: JUnit 4) [1..4] 4

   Project name (default: java-app):
   Source package (default: java.app): io.huna

   > Task :init
   Get more help with your project: https://docs.gradle.org/6.4/userguide/tutorial_java_projects.html

   BUILD SUCCESSFUL in 44s
   2 actionable tasks: 2 executed
   ```
   - 프로젝트 타입은 `2: application` 선택
   - 언어 선택은 `3: Java` 선택
     - ~~음... 언어 선택이 제일 먼저 나오는게 순서가 자연스럽지 않을까...?~~ :)
   - 빌드 스크립트는 입맛에 맞는거 아무거나 (여기서는가`Groovy` 선택)
   - 테스트 프레임워크는 역시 입맛에 맞게 아무거나 (여기서는 `4: JUnit Jupiter`)
   - `Source package`의 기본값인 `java.app`을 그대로 사용하면 `java.lang.SecurityException` 에러가 발생함
     > 패키지 명칭으로 `java`는 사용 불가
1. 프로젝트 구조 확인
   ```
   tree
   .
   ├── build.gradle
   ├── gradle
   │   └── wrapper
   │       ├── gradle-wrapper.jar
   │       └── gradle-wrapper.properties
   ├── gradlew
   ├── gradlew.bat
   ├── settings.gradle
   └── src
       ├── main
       │   ├── java (1)
       │   │   └── io
       │   │       └── huna
       │   │           └── App.java
       │   └── resources
       └── test
           ├── java (2)
           │   └── io
           │       └── huna
           │           └── AppTest.java
           └── resources
   
   13 directories, 8 files
   ```
   1. 기본 자바 소스코드 위치
   1. 기본 자바 테스트코드 위치
1. [`build.gradle`](../00.playground/01.Gradle/java-app/build.gradle) 파일 내용 확인 (개발새발 영어 해석...)
   ```
   /*
    * This file was generated by the Gradle 'init' task.
    *
    * This generated file contains a sample Java project to get you started.
    * For more details take a look at the Java Quickstart chapter in the Gradle
    * User Manual available at https://docs.gradle.org/6.4/userguide/tutorial_java_projects.html
    */
   
   plugins {
       // Java 사용을 위한 플러그인
       id 'java'
   
       // CLI app 구성을 위한 플러그인
       id 'application'
   }
   
   repositories {
       // 아래 `dependencies`에 선언된 라이브러리들을 가져올 장소 지정
       // jcenter()는 `Bintary Artifactory`를 의미
       jcenter()
   }
   
   dependencies {
       // app에서 사용될 의존성
       implementation 'com.google.guava:guava:28.2-jre'
   
       // 테스트시 사용할 JUnit Jupiter API
       testImplementation 'org.junit.jupiter:junit-jupiter-api:5.6.0'
   
       // 테스트시 사용할 JUnit Jupiter Engine
       testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.6.0'
   }
   
   application {
       // App의 메인 클래스 지정
       mainClassName = 'java.app.App'
   }
   
   test {
       // 유닛 테스트시 Junit platform 사용
       useJUnitPlatform()
   }
   ```
1. 사용 가능한 태스크 종류 확인
   ```
   ./gradlew tasks
   Starting a Gradle Daemon, 1 incompatible Daemon could not be reused, use --status for details
   
   > Task :tasks
   
   ------------------------------------------------------------
   Tasks runnable from root project
   ------------------------------------------------------------
   
   Application tasks
   -----------------
   run - Runs this project as a JVM application
   
   Build tasks
   -----------
   assemble - Assembles the outputs of this project.
   build - Assembles and tests this project.
   buildDependents - Assembles and tests this project and all projects that depend on it.
   buildNeeded - Assembles and tests this project and all projects it depends on.
   classes - Assembles main classes.
   clean - Deletes the build directory.
   jar - Assembles a jar archive containing the main classes.
   testClasses - Assembles test classes.
   
   Build Setup tasks
   -----------------
   init - Initializes a new Gradle build.
   wrapper - Generates Gradle wrapper files.
   
   Distribution tasks
   ------------------
   assembleDist - Assembles the main distributions
   distTar - Bundles the project as a distribution.
   distZip - Bundles the project as a distribution.
   installDist - Installs the project as a distribution as-is.
   
   Documentation tasks
   -------------------
   javadoc - Generates Javadoc API documentation for the main source code.
   
   Help tasks
   ----------
   buildEnvironment - Displays all buildscript dependencies declared in root project 'java-app'.
   components - Displays the components produced by root project 'java-app'. [incubating]
   dependencies - Displays all dependencies declared in root project 'java-app'.
   dependencyInsight - Displays the insight into a specific dependency in root project 'java-app'.
   dependentComponents - Displays the dependent components of components in root project 'java-app'. [incubating]
   help - Displays a help message.
   model - Displays the configuration model of root project 'java-app'. [incubating]
   outgoingVariants - Displays the outgoing variants of root project 'java-app'.
   projects - Displays the sub-projects of root project 'java-app'.
   properties - Displays the properties of root project 'java-app'.
   tasks - Displays the tasks runnable from root project 'java-app'.
   
   Verification tasks
   ------------------
   check - Runs all checks.
   test - Runs the unit tests.
   
   Rules
   -----
   Pattern: clean<TaskName>: Cleans the output files of a task.
   Pattern: build<ConfigurationName>: Assembles the artifacts of a configuration.
   Pattern: upload<ConfigurationName>: Assembles and uploads the artifacts belonging to a configuration.
   
   To see all tasks and more detail, run gradlew tasks --all
   
   To see more detail about a task, run gradlew help --task <task>
   
   BUILD SUCCESSFUL in 5s
   1 actionable task: 1 executed
   ```
   - 앞에 튜토리얼에선 보지 못한 Java 관련 태스크들이 보인다. 수행해보자
1. `classes` 태스크
   ```
   $ ./gradlew classes
   
   BUILD SUCCESSFUL in 768ms
   1 actionable task: 1 executed
   ```
   - 디렉토리 구조를 확인해보면 `build`라는 디렉토리가 생겼고, class 파일이 생성된걸 확인할 수 있음
     ```
     .
     ├── build
     │   ├── classes
     │   │   └── java
     │   │       └── main
     │   │           └── io
     │   │               └── huna
     │   │                   └── App.class
     │   ├── generated
     │   │   └── sources
     │   │       ├── annotationProcessor
     │   │       │   └── java
     │   │       │       └── main
     │   │       └── headers
     │   │           └── java
     │   │               └── main
     │   └── tmp
     │       └── compileJava
     ├── build.gradle
     ├── gradle
     │   └── wrapper
     │       ├── gradle-wrapper.jar
     │       └── gradle-wrapper.properties
     ├── gradlew
     ├── gradlew.bat
     ├── settings.gradle
     └── src
         ├── main
         │   ├── java
         │   │   └── io
         │   │       └── huna
         │   │           └── App.java
         │   └── resources
         └── test
             ├── java
             │   └── io
             │       └── huna
             │           └── AppTest.java
             └── resources
    
     29 directories, 9 files
     ```
     - `build` 태스크랑 다른점은 그냥 class 파일들만 생성했다는 점
1. `jar` 태스크 수행
   ```
   $ ./gradlew jar
   
   BUILD SUCCESSFUL in 647ms
   2 actionable tasks: 2 executed
   ```
   - 디렉토리 구조 확인
     ```
     .
     ├── build
     │   ├── classes
     │   │   └── java
     │   │       └── main
     │   │           └── io
     │   │               └── huna
     │   │                   └── App.class
     │   ├── generated
     │   │   └── sources
     │   │       ├── annotationProcessor
     │   │       │   └── java
     │   │       │       └── main
     │   │       └── headers
     │   │           └── java
     │   │               └── main
     │   ├── libs
     │   │   └── java-app.jar
     │   └── tmp
     │       ├── compileJava
     │       └── jar
     │           └── MANIFEST.MF
     ├── build.gradle
     ├── gradle
     │   └── wrapper
     │       ├── gradle-wrapper.jar
     │       └── gradle-wrapper.properties
     ├── gradlew
     ├── gradlew.bat
     ├── settings.gradle
     └── src
         ├── main
         │   ├── java
         │   │   └── io
         │   │       └── huna
         │   │           └── App.java
         │   └── resources
         └── test
             ├── java
             │   └── io
             │       └── huna
             │           └── AppTest.java
             └── resources
   
     31 directories, 11 files
     ```
     - `classes` 태스크와 비슷하지만 `libs/java-app.jar` 파일과 `tmp` 디렉토리가 생성된걸 확인할 수 있음
1. 그럼 `build` 태스크를 수행
   ```
   $ ./gradlew build
   
   BUILD SUCCESSFUL in 1s
   7 actionable tasks: 7 executed
   ```
   - 디렉토리 구조 확인
     ```
     .
     ├── build
     │   ├── classes
     │   │   └── java
     │   │       ├── main
     │   │       │   └── io
     │   │       │       └── huna
     │   │       │           └── App.class
     │   │       └── test
     │   │           └── io
     │   │               └── huna
     │   │                   └── AppTest.class
     │   ├── distributions
     │   │   ├── java-app.tar
     │   │   └── java-app.zip
     │   ├── generated
     │   │   └── sources
     │   │       ├── annotationProcessor
     │   │       │   └── java
     │   │       │       ├── main
     │   │       │       └── test
     │   │       └── headers
     │   │           └── java
     │   │               ├── main
     │   │               └── test
     │   ├── libs
     │   │   └── java-app.jar
     │   ├── reports
     │   │   └── tests
     │   │       └── test
     │   │           ├── classes
     │   │           │   └── io.huna.AppTest.html
     │   │           ├── css
     │   │           │   ├── base-style.css
     │   │           │   └── style.css
     │   │           ├── index.html
     │   │           ├── js
     │   │           │   └── report.js
     │   │           └── packages
     │   │               └── io.huna.html
     │   ├── scripts
     │   │   ├── java-app
     │   │   └── java-app.bat
     │   ├── test-results
     │   │   └── test
     │   │       ├── TEST-io.huna.AppTest.xml
     │   │       └── binary
     │   │           ├── output.bin
     │   │           ├── output.bin.idx
     │   │           └── results.bin
     │   └── tmp
     │       ├── compileJava
     │       ├── compileTestJava
     │       └── jar
     │           └── MANIFEST.MF
     ├── build.gradle
     ├── gradle
     │   └── wrapper
     │       ├── gradle-wrapper.jar
     │       └── gradle-wrapper.properties
     ├── gradlew
     ├── gradlew.bat
     ├── settings.gradle
     └── src
         ├── main
         │   ├── java
         │   │   └── io
         │   │       └── huna
         │   │           └── App.java
         │   └── resources
         └── test
             ├── java
             │   └── io
             │       └── huna
             │           └── AppTest.java
             └── resources
   
     49 directories, 26 files
     ```
     - `build` 태스크에 걸맞게 build 디렉토리 내에 굉장히 많은 정보들을 포함
     - 그중에 잘 보면 테스트 결과도 포함되어 있음
       - 만약 빌드시 테스트를 실패하면 빌드도 실패함
       - 테스트 결과는 [여기](../00.playground/01.Gradle/java-app/build/reports/tests/test/index.html)에 이쁘게 생성되어 있음
         - 빌드 실패시에도 위와 같이 html 파일로 결과를 보여주므로 한번씩 확인 필요
1. 마지막으로, app 실행을 위한 `run` 태스크 수행
   ```
   $ ./gradlew run
   
   > Task :run
   Hello world.
   
   BUILD SUCCESSFUL in 694ms
   2 actionable tasks: 2 executed
   ```
   - `Hello world.` 가 아름답게 찍힌다.
   - 디렉토리 구조도 확인해보자
     ```
     .
     ├── build
     │   ├── classes
     │   │   └── java
     │   │       └── main
     │   │           └── io
     │   │               └── huna
     │   │                   └── App.class
     │   ├── generated
     │   │   └── sources
     │   │       ├── annotationProcessor
     │   │       │   └── java
     │   │       │       └── main
     │   │       └── headers
     │   │           └── java
     │   │               └── main
     │   └── tmp
     │       └── compileJava
     ├── build.gradle
     ├── gradle
     │   └── wrapper
     │       ├── gradle-wrapper.jar
     │       └── gradle-wrapper.properties
     ├── gradlew
     ├── gradlew.bat
     ├── settings.gradle
     └── src
         ├── main
         │   ├── java
         │   │   └── io
         │   │       └── huna
         │   │           └── App.java
         │   └── resources
         └── test
             ├── java
             │   └── io
             │       └── huna
             │           └── AppTest.java
             └── resources
     
     29 directories, 9 files
     ```
     - `classes` 태스크와 동일하게 class 파일들만 생성된 것을 확인 할 수 있음